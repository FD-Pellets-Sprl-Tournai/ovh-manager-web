<div data-ng-controller="EmailsMigrateAccountCtrl as ctrl">
    <oui-back-button data-title="{{::tr('email_tab_modal_migrate_title')}}"
        data-on-click="ctrlEmailDomainEmail.displayEmailsList()">
    </oui-back-button>

    <p>
        <a class="oui-link oui-link_icon" href="{{::ctrl.allGuides}}" target="_blank">
            <span data-i18n-static="email_tab_modal_migrate_configuration_guides_button"></span>
            <span class="oui-icon oui-icon-external_link" aria-hidden="true"></span>
        </a>
    </p>

    <!-- Email Account -->
    <div class="oui-field">
        <label class="oui-field__label oui-label"
            data-i18n-static="email_tab_modal_migrate_account_email_label">
        </label>
        <div class="oui-field__control oui-field__control_m">
            <p data-ng-bind="ctrl.email.email"></p>
        </div>
    </div>
    <!-- /Email Account -->

    <oui-stepper data-linear
        data-on-finish="ctrl.migrateAccount()">

        <!-- Step 1: Destination -->
        <oui-step-form data-header="{{::tr('email_tab_modal_migrate_detination_step_title')}}"
            data-loading="ctrl.loaders.isInitialRetrievalRunning"
            data-navigation="ctrl.availableServices"
            data-on-focus="ctrl.destinationFocused = true"
            data-on-submit="ctrl.getDestinationEmails(ctrl.migrate.destinationService.name)">

            <!-- No Service -->
            <div data-ng-if="!ctrl.availableServices">
                <p data-i18n-static="email_tab_modal_migrate_no_email_service"></p>
                <p>
                    <a href="{{::ctrl.emailsOrder}}" target="_blank" class="btn btn-primary">
                        <span data-i18n-static="email_tab_modal_migrate_order_email_service"></span>
                        <span class="fa fa-external-link"></span>
                    </a>
                </p>
            </div>
            <!-- /No Service -->

            <!-- Has Services -->
            <div class="oui-field"
                data-ng-if="ctrl.availableServices">
                <label class="oui-field__label oui-label"
                    data-i18n-static="email_tab_modal_migrate_destination_service_label">
                </label>
                <div class="row oui-field__control oui-field__control_auto">
                    <div class="col-md-{{(12 / ctrl.availableServices)}}"
                        data-ng-repeat="(serviceType, destinationService) in ctrl.destinationServices"
                        data-ng-hide="!ctrl.destinationFocused && (ctrl.migrate.destinationService.type !== serviceType)">
                        <oui-select-picker name="serviceType"
                            data-text="{{::serviceType}}"
                            data-placeholder="{{::tr('select_placeholder')}}"
                            data-model="ctrl.migrate.destinationService"
                            data-match="name"
                            data-values="destinationService">
                        </oui-select-picker>
                    </div>
                </div>
            </div>
            <!-- /Has Services -->

        </oui-step-form>
        <!-- /Step 1: Destination -->

        <!-- Step 2: Informations -->
        <oui-step-form data-header="{{::tr('email_tab_modal_migrate_informations_step_title')}}"
            data-loading="ctrl.loaders.isWaitingForDestinationEmails"
            data-valid="ctrl.migrate.destinationEmail"
            data-navigation="ctrl.migrate.destinationEmail"
            data-on-focus="ctrl.destinationFocused = false"
            data-on-submit="ctrl.checkMigrationData()">

            <!-- Has available email address -->
            <div data-ng-if="ctrl.migrate.destinationEmail">

                <!-- Before -->
                <h4 data-i18n-static="email_tab_modal_migrate_informations_before_title"></h4>
                <p>
                    <span data-ng-bind-html="tr('email_tab_modal_migrate_available_email_selected', ctrl.migrate.destinationEmail)"></span>
                    <span data-i18n-static="email_tab_modal_migrate_not_supported"></span>
                </p>
                <!-- /Before -->

                <!-- While -->
                <h4 data-i18n-static="email_tab_modal_migrate_informations_while_title"></h4>
                <p>
                    <span data-ng-bind-html="::tr('email_tab_modal_migrate_confirmation_delay')"></span>
                    <span data-i18n-static="email_tab_modal_migrate_cant_cancel_or_access"></span>
                    <span data-i18n-static="email_tab_modal_migrate_alert_dont_change_password"></span>
                </p>
                <!-- /While -->

                <!-- After -->
                <h4 data-i18n-static="email_tab_modal_migrate_informations_after_title"></h4>
                <p>
                    <span data-ng-if="ctrl.remainingAvailableEmails"
                        data-ng-bind-html="tr('email_tab_modal_migrate_remaining_available_emails', ctrl.remainingAvailableEmails.toString())">
                    </span>
                    <span data-ng-if="!ctrl.remainingAvailableEmails"
                        data-i18n-static="email_tab_modal_migrate_no_remaining_available_emails">
                    </span>
                    <span data-i18n-static="email_tab_modal_migrate_email_deleted"></span>
                    <span data-i18n-static="email_tab_modal_migrate_email_reconfiguration"></span>
                </p>
                <!-- /After -->


                <!-- Aknowledge Checkbox -->
                <oui-field>
                    <oui-checkbox name="aknowledge" required
                        data-text="{{::tr('email_tab_modal_migrate_aknowledge')}}"
                        data-model="ctrl.migrate.aknowledge">
                    </oui-checkbox>
                </oui-field>
                <!-- /Aknowledge Checkbox -->

            </div>
            <!-- /Has available email address -->

            <!-- No available email address -->
            <div data-ng-if="!ctrl.migrate.destinationEmail">
                <p>
                    <span data-ng-bind-html="tr('email_tab_modal_migrate_no_available_email', ctrl.migrate.destinationService.name)"></span>
                    <span data-i18n-static="email_tab_modal_migrate_configure_me"></span>
                </p>
                <p>
                    <span data-i18n-static="email_tab_modal_migrate_choose_another_service_or"></span>
                    <a class="oui-link oui-link_icon" href="/#/configuration/email_pro/{{::ctrl.migrate.destinationService.name}}?tab=ACCOUNT" target="_blank"
                        data-ng-if="ctrl.migrate.destinationService.type === 'EMAIL PRO'">
                        <span data-i18n-static="email_tab_modal_migrate_order_new_emails_button"></span>
                        <span class="oui-icon oui-icon-external_link" aria-hidden="true"></span>
                    </a>
                    <a class="oui-link oui-link_icon" href="/#/configuration/exchange_hosted/{{::ctrl.migrate.destinationService.name}}/{{::ctrl.migrate.destinationService.name}}?tab=ACCOUNT" target="_blank"
                        data-ng-if="ctrl.migrate.destinationService.type === 'HOSTED EXCHANGE'">
                        <span data-i18n-static="email_tab_modal_migrate_order_new_emails_button"></span>
                        <span class="oui-icon oui-icon-external_link" aria-hidden="true"></span>
                    </a>
                </p>
            </div>
            <!-- /No available email address -->

        </oui-step-form>
        <!-- /Step 2: Informations -->

        <!-- Step 3: Confirmation -->
        <oui-step-form data-header="{{::tr('email_tab_modal_migrate_confirmation_step_title')}}"
            data-loading="ctrl.loaders.isWaitingForMigrationCheck || ctrl.loaders.isWaitingForMigration"
            data-valid="ctrl.isMigrationDataValid"
            data-navigation="ctrl.isMigrationDataValid"
            data-submit-text="{{::tr('email_tab_modal_migrate_submit')}}"
            data-cancel-text="{{::tr('wizard_cancel')}}"
            data-on-cancel="ctrlEmailDomainEmail.displayEmailsList()">

            <!-- Migration data invalid -->
            <oui-message type="warning" data-ng-if="ctrl.shouldDisplayCheckMigrationsErrors">
                <span data-ng-bind-html="ctrl.checkMigrationErrorLabel"></span>
                <ul>
                    <li data-ng-repeat="error in ctrl.checkMigrationErrors"
                        data-ng-bind-html="error"></li>
                </ul>
            </oui-message>
            <!-- /Migration data invalid -->

            <!-- Migration data valid -->
            <div data-ng-if="ctrl.isMigrationDataValid">

                <!-- Password -->
                <oui-field data-label="{{::tr('email_tab_modal_migrate_confirmation_password')}}"
                    data-size="m">
                    <input class="oui-input" id="accountPassword" name="accountPassword"
                        type="password" autocomplete="off" required
                        data-ng-maxlength="ctrl.constants.passwordMaxLength"
                        data-ng-minlength="ctrl.constants.passwordMinLength"
                        data-ng-model="ctrl.migrate.password">
                </oui-field>
                <!-- /Password -->

            </div>
            <!-- /Migration data valid -->

        </oui-step-form>
        <!-- /Step 3: Confirmation -->

    </oui-stepper>

    <!-- Migrate Alert -->
    <div data-ovh-alert="{{alerts.migrate}}"
        data-ovh-alert-hide-remove-button>
    </div>
    <!-- /Migrate Alert -->

</div>
